<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BCVWorld Java Resources - Download Center</title>

  <!-- Global CONFIG (must be before scripts that read CONFIG) -->
  <script>
    window.CONFIG = {
      popupDelayMsDesktop: 4000,
      popupDelayMsMobile: 6000,
      popupAutoCloseSec: 15,
      stickyShowDelayMsDesktop: 12000,
      stickyShowDelayMsMobile: 8000,
      stickyAutoCloseMsMobile: 30000,
      scrollTriggerPx: 420,
      minDesktopWidth: 769,
      adsenseClientId: 'ca-pub-6284022198338659',
      popunderUrl: 'https://otieu.com/4/10247181'
    };
  </script>

  <!-- AdSense script -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6284022198338659"
    crossorigin="anonymous"></script>

  <link href="/css/javaresource.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>
<body>
  <div id="header-container"></div>

  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <h2>Master Java with Our Complete Resource Pack</h2>
      <p>Download comprehensive Java learning materials, code examples, and projects specifically designed for freshers.</p>
    </div>
  </section>

  <div class="container">
    <div class="main-content">
      <!-- Left ads -->
      <aside class="ads-section">
        <div class="ad-container">
          <div class="ad-label">Advertisement</div>
          <div class="ad-content responsive-ad">
            <ins class="adsbygoogle" 
                 style="display:block"
                 data-ad-client="ca-pub-6284022198338659"
                 data-ad-slot="7091309532"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
          </div>
        </div>
        <div class="ad-container">
          <div class="ad-label">Sponsored</div>
          <div class="ad-content tall-ad">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-6284022198338659"
                 data-ad-slot="4465146196"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
          </div>
        </div>
      </aside>

      <!-- Download cards area -->
      <section class="download-section">
        <h2>Java Resources</h2>
        <div class="resource-controls">
          <input type="text" id="searchInput" class="resource-search" placeholder="Search resources" />
          <select id="categoryFilter" class="resource-filter">
            <option value="all">All Categories</option>
            <option value="core">Core Java</option>
            <option value="spring">Spring & Spring Boot</option>
            <option value="microservices">Microservices</option>
            <option value="sql">SQL & Database</option>
            <option value="testing">Testing (JUnit/Mockito)</option>
            <option value="tools">Build & VCS (Maven/Git/Gradle)</option>
            <option value="streams">Streams & Coding</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="resource-list"></div>

        <div class="section-ad">
          <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <div class="ad-content horizontal-ad">
              <ins class="adsbygoogle"
                   style="display:block"
                   data-ad-client="ca-pub-6284022198338659"
                   data-ad-slot="8659542079"
                   data-ad-format="auto"
                   data-full-width-responsive="true"></ins>
            </div>
          </div>
        </div>

        <div class="section-ad">
          <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <div class="ad-content horizontal-ad">
              <ins class="adsbygoogle"
                   style="display:block"
                   data-ad-client="ca-pub-6284022198338659"
                   data-ad-slot="2303400170"
                   data-ad-format="auto"
                   data-full-width-responsive="true"></ins>
            </div>
          </div>
        </div>
      </section>

      <!-- Right ads -->
      <aside class="ads-section">
        <div class="ad-container">
          <div class="ad-label">Advertisement</div>
          <div class="ad-content responsive-ad">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-6284022198338659"
                 data-ad-slot="3421040729"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
          </div>
        </div>
        <div class="ad-container">
          <div class="ad-label">Sponsored</div>
          <div class="ad-content tall-ad">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-6284022198338659"
                 data-ad-slot="6983498326"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Download Modal -->
  <div class="modal" id="downloadModal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Complete Ad to Download</h3>
        <button class="close-modal" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="ad-video-container">
          <div class="ad-video-placeholder"></div>
          <p>Please view the advertisement to enable download.</p>
        </div>

        <div class="download-progress">
          <p>Ad Progress: <span id="progressText">0%</span></p>
          <div class="progress-bar">
            <div class="progress" id="adProgress"></div>
          </div>
        </div>

        <div class="download-ready" id="downloadReady" style="display:none">
          <h4>Ad Completed! Your download is ready.</h4>
          <a href="#" class="download-btn" id="finalDownload">Download File</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Popup Ad -->
  <div class="popup-ad" id="popupAd" role="dialog" aria-modal="true">
    <div class="popup-body">
      <button class="popup-close" aria-label="Close">&times;</button>
      <h3 class="popup-title">Sponsored</h3>
      <div class="popup-ad-content">
        <ins class="adsbygoogle" style="display:block"
             data-ad-client="ca-pub-6284022198338659"
             data-ad-slot="9525901183"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      </div>
      <div class="popup-timer" id="popupTimer">This ad will close in <span id="timerCount">10</span> seconds</div>
    </div>
  </div>

  <!-- Ads Popup (center modal) -->
  <div class="ads-popup" id="adsPopup" role="dialog" aria-modal="true">
    <div class="ads-popup-content">
      <div class="ads-popup-header">
        <span>Advertisement</span>
        <button class="ads-popup-close" id="adsPopupClose" aria-label="Close">&times;</button>
      </div>
      <div class="ads-popup-body">
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6284022198338659"
            data-ad-slot="4089957271" data-ad-format="auto" data-full-width-responsive="true"></ins>
      </div>
    </div>
  </div>

  <div id="footer-container"></div>

  <!-- Corrected JS (robust init + ensureAdOrFallback) -->
  <script>
  (function(){
    'use strict';

    // ---------- Data ----------
    const basePath = '/assets/javapdf/';
    const AD_CLIENT = (window.CONFIG && window.CONFIG.adsenseClientId) || 'ca-pub-6284022198338659';
    const pdfFiles = [
      'Spring.pdf',
      'Step-26-Non-Techincal-Lead-level-Questions.pdf',
      'Step-25-Junit-and-Mockito.pdf',
      'Step-23-Maven-and-Git-Level-I.pdf',
      'Step-22-Microservices-Design-Patterns.pdf',
      'Step-21-Microservices-Level-II.pdf',
      'Step-20-Microservices-Level-I.pdf',
      'Step-19-Kafka-Optional.pdf',
      'Step-18-Spring-Data-JPA-and-Other-DB-Level-I.pdf',
      'Step-17-SQL.pdf',
      'Step-16-Spring-MVC-Level-I-Optional.pdf',
      'Step-15-Spring-Security-Level-II.pdf',
      'Step-14-Spring-Security-Level-I.pdf',
      'Step-13-Spring-Boot-Level-V-Expert.pdf',
      'Step-12-Spring-Boot-level-IV-Advance.pdf',
      'Step-11-Spring-Boot-Level-III-Scenario-Based.pdf',
      'Step-10-Spring-Boot-Level-II.pdf',
      'Step-9-Spring-Boot-Level-I.pdf',
      'Step-8-Spring-framework-Level-II.pdf',
      'Step-4-Core-Java-Level-IV-Advance-Level.pdf',
      'Common-Step-Stream-API-Coding-Level-I-2.pdf',
      'Common-Step-Java-Coding-2.pdf',
      'Step-23-Junit-and-Mockito.pdf',
      'Step-22-Maven-and-Git-Gradle-and-Deployments-Level-II.pdf',
      'Step-21-Maven-and-Git-Level-I.pdf',
      'Step-20-Microservices-Design-Patterns.pdf',
      'Step-19-Microservices-Level-II.pdf',
      'Step-18-Microservices-Level-I.pdf',
      'Step-17-Kafka-Optional.pdf',
      'Step-16-Spring-Data-JPA-and-Other-DB-Level-I.pdf',
      'Step-15-SQL.pdf',
      'Step-14-Spring-MVC-Level-I-Optional.pdf',
      'Step-13-Spring-Security-Level-II.pdf',
      'Step-12-Spring-Security-Level-I.pdf',
      'Step-11-Spring-Boot-level-IV-Advance.pdf',
      'Step-10-Spring-Boot-Level-III-Scenario-Based.pdf',
      'Step-9-Spring-Security-Level-II.pdf',
      'Step-6-Spring-Framework-Level-I.pdf',
      'Common-Step-Java-Coding-1.pdf',
      'Step-17-Junit-and-Mockito.pdf',
      'Step-16-Maven-and-Git-Gradle-and-Deployments-Level-II.pdf',
      'Step-15-Maven-and-Git-Level-I.pdf',
      'Step-14-Microservices-Level-I.pdf',
      'Step-13-Kafka-Optional.pdf',
      'Step-12-Spring-Data-JPA-and-Other-DB-Level-I.pdf',
      'Step-11-SQL.pdf',
      'Step-10-Spring-MVC-Level-I-Optional.pdf',
      'Step-9-Spring-Security-Level-I.pdf',
      'Step-8-Spring-Boot-Level-III-Scenario-Based.pdf',
      'Step-7-Spring-Boot-Level-II.pdf',
      'Step-5-Spring-framework-Level-II.pdf',
      'Step-3-Core-Java-Level-III.pdf',
      'Common-Step-Stream-API-Coding-Level-II.pdf',
      'Common-Step-Stream-API-Coding-Level-I.pdf',
      'Common-Step-Java-Coding.pdf',
      'Step-9-Maven-and-Git-Level-I.pdf',
      'Step-8-Microservices-Level-I.pdf',
      'Step-7-SQL.pdf',
      'Step-4-Spring-Boot-Level-I.pdf',
      'Step-2-Core-Java-Level-II.pdf',
      'Step-1-Core-Java-Level-I.pdf',
      'Common-Step-Stream-API-Coding-Questions-Level-I.pdf',
      'Java-PDF-Notes.pdf',
      'Spring-Framework-Notes.pdf',
      'SQL-Hand-written-notes.pdf',
      'SQL-PDF-Notes.pdf'
    ];

    function toTitle(name) {
      return name
        .replace(/\.pdf$/i, '')
        .replace(/[-_]+/g, ' ')
        .replace(/(^|\s)step\s*\d+(\s|$)/gi, ' ')
        .replace(/\s{2,}/g, ' ')
        .trim();
    }

    // ---------- Query key nodes EARLY ----------
    const cardsContainer = document.querySelector('.resource-list');
    const pageSize = 10;
    let currentPage = 1;
    let dynamicTotalPages = Math.max(1, Math.ceil(pdfFiles.length / pageSize));

    // Modal & popup elements (queried before render)
    let downloadModal = document.getElementById('downloadModal');
    let closeModal = document.querySelector('.close-modal');
    let progressBar = document.getElementById('adProgress');
    let progressText = document.getElementById('progressText');
    let downloadReady = document.getElementById('downloadReady');
    let finalDownload = document.getElementById('finalDownload');
    let currentFile = '';
    let adInterval = null;
    let adProgressValue = 0;

    function stopAdProgress(){ if (adInterval) { clearInterval(adInterval); adInterval = null; } }
    function resetDownloadState(){
      adProgressValue = 0;
      if (progressBar) progressBar.style.width = '0%';
      if (progressText) progressText.textContent = '0%';
      if (downloadReady) downloadReady.style.display = 'none';
      if (finalDownload) finalDownload.removeAttribute('href');
    }

    function safeQuery(selector, ctx=document){ try { return ctx.querySelector(selector); } catch(e) { return null; } }
    function isMobile(){ return (window.innerWidth || document.documentElement.clientWidth) < 768; }

    function isVisible(el){
      try {
        return !!(el && (el.classList && el.classList.contains('show') || (el.style && el.style.display && el.style.display !== 'none')));
      } catch(e) { return false; }
    }

    function openPopunder(){
      try {
        const url = (window.CONFIG && window.CONFIG.popunderUrl) || '';
        if (!url) return;
        const w = window.open(url, '_blank');
        if (w && typeof w.blur === 'function') { w.blur(); }
        if (typeof window.focus === 'function') window.focus();
      } catch(_) {}
    }

    function getCategory(file){
      const f = file.toLowerCase();
      if (/core\s*java|step-1|step-2|core-java/.test(f)) return 'core';
      if (/spring\s*boot|spring\s*framework|step-4|step-7|step-8|spring-boot|spring-framework/.test(f)) return 'spring';
      if (/microservices/.test(f)) return 'microservices';
      if (/sql|database|jpa/.test(f)) return 'sql';
      if (/junit|mockito|testing/.test(f)) return 'testing';
      if (/maven|git|gradle|deploy/.test(f)) return 'tools';
      if (/stream\s*api|coding/.test(f)) return 'streams';
      return 'other';
    }

    function buildItem(file) {
      const title = toTitle(file);
      const cat = getCategory(file);
      const iconText = 'PDF';
      return `
        <div class="resource-item">
          <div class="resource-info">
            <div class="resource-icon">${iconText}</div>
            <div class="resource-text">
              <div class="resource-title">${title}</div>
              <div class="resource-meta">${cat}</div>
            </div>
          </div>
          <div class="resource-actions">
            <button class="download-btn" data-file="${file}">Watch Ad to Download</button>
          </div>
        </div>
      `;
    }

    function buildInlineAd(index) {
      const adSlots = ['7551857423','2303400170','8659542079','9603305692'];
      const adSlot = adSlots[index % adSlots.length];
      return `
        <div class="ad-container">
          <div class="ad-label">Advertisement</div>
          <div class="ad-content horizontal-ad">
            <ins class="adsbygoogle" style="display:block" data-ad-client="${AD_CLIENT}" data-ad-slot="${adSlot}" data-ad-format="auto" data-full-width-responsive="true"></ins>
          </div>
        </div>
      `;
    }

    function buildPagination() {
      const pages = Array.from({length: dynamicTotalPages},(_,i) => i+1).map(p => `<button class="page-link ${p===currentPage ? 'active' : ''}" data-page="${p}" ${p===currentPage ? 'disabled' : ''}>${p}</button>`).join('');
      return `<div class="pagination-controls"><button class="page-prev" ${currentPage===1 ? 'disabled' : ''}>Prev</button>${pages}<button class="page-next" ${currentPage===dynamicTotalPages ? 'disabled' : ''}>Next</button></div>`;
    }

    let searchTerm = '';
    let selectedCategory = 'all';

    function applyFilters(items){
      return items.filter(f => {
        const title = toTitle(f).toLowerCase();
        const cat = getCategory(f);
        const termOk = !searchTerm || title.includes(searchTerm.toLowerCase());
        const catOk = selectedCategory === 'all' || cat === selectedCategory;
        return termOk && catOk;
      });
    }

    function renderPage(page) {
      const filtered = applyFilters(pdfFiles);
      dynamicTotalPages = Math.max(1, Math.ceil(filtered.length / pageSize));
      currentPage = Math.max(1, Math.min(page, dynamicTotalPages));
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const items = filtered.slice(start, end);

      let html = '';
      items.forEach((file, idx) => {
        html += buildItem(file);
        if ((idx + 1) % 2 === 0) {
          html += buildInlineAd(start + idx + 1);
        }
      });
      html += buildPagination();
      if (cardsContainer) cardsContainer.innerHTML = html;

      setTimeout(() => loadAllAds(), 150);
      attachPaginationHandlers();
      attachDownloadHandlers();
    }

    function attachPaginationHandlers() {
      if (!cardsContainer) return;
      const prev = cardsContainer.querySelector('.page-prev');
      const next = cardsContainer.querySelector('.page-next');
      const links = cardsContainer.querySelectorAll('.page-link');
      if (prev) prev.addEventListener('click', () => renderPage(currentPage - 1));
      if (next) next.addEventListener('click', () => renderPage(currentPage + 1));
      links.forEach(l => l.addEventListener('click', () => renderPage(parseInt(l.getAttribute('data-page'), 10))));
    }

    function attachDownloadHandlers() {
      if (!cardsContainer) return;
      const buttons = cardsContainer.querySelectorAll('.download-btn');
      buttons.forEach(button => {
        const newBtn = button.cloneNode(true);
        button.parentNode.replaceChild(newBtn, button);
        newBtn.addEventListener('click', function () {
          openPopunder();
          const file = this.getAttribute('data-file');
          currentFile = file;
          // re-query fresh nodes
          downloadModal = document.getElementById('downloadModal');
          closeModal = document.querySelector('.close-modal');
          progressBar = document.getElementById('adProgress');
          progressText = document.getElementById('progressText');
          downloadReady = document.getElementById('downloadReady');
          finalDownload = document.getElementById('finalDownload');

          if (downloadModal) downloadModal.classList.add('show');
          ensureAdOrFallback('.ad-video-placeholder', 4831035752);
          stopAdProgress();
          resetDownloadState();

          // try to load ads (safe)
          try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch(e){ /* ignore */ }

          adInterval = setInterval(() => {
            adProgressValue += 1;
            if (progressBar) progressBar.style.width = adProgressValue + '%';
            if (progressText) progressText.textContent = adProgressValue + '%';
            if (adProgressValue >= 100) {
              stopAdProgress();
              setTimeout(() => {
                if (downloadReady) downloadReady.style.display = 'block';
                if (finalDownload) {
                  finalDownload.href = basePath + currentFile;
                  finalDownload.setAttribute('download', currentFile);
                }
              }, 300);
            }
          }, 250);
        });
      });
    }

    function loadAllAds() {
      const adElements = document.querySelectorAll('.adsbygoogle[data-ad-client]:not([data-adsbygoogle-status])');
      adElements.forEach(ad => {
        try {
          (adsbygoogle = window.adsbygoogle || []).push({});
        } catch (e) {
          console.error('Ad loading error:', e);
        }
      });
    }

    function renderAdIn(containerSelector, slotId) {
      const container = document.querySelector(containerSelector);
      if (!container) return;
      container.innerHTML = '';
      const ins = document.createElement('ins');
      ins.className = 'adsbygoogle';
      ins.style.display = 'block';
      ins.setAttribute('data-ad-client', AD_CLIENT);
      ins.setAttribute('data-ad-slot', String(slotId));
      ins.setAttribute('data-ad-format', 'auto');
      ins.setAttribute('data-full-width-responsive', 'true');
      container.appendChild(ins);
      try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch (e) {}
    }

    // === NEW: ensureAdOrFallback ===
    // Ensures that an ad or a non-blocking fallback is placed into the container.
    function ensureAdOrFallback(containerSelector, slotId) {
      try {
        const container = document.querySelector(containerSelector);
        if (!container) return;

        // clear any existing children
        container.innerHTML = '';

        // If AdSense is available, add a real ad element
        if (window.adsbygoogle && typeof window.adsbygoogle.push === 'function') {
          const ins = document.createElement('ins');
          ins.className = 'adsbygoogle';
          ins.style.display = 'block';
          ins.setAttribute('data-ad-client', AD_CLIENT);
          ins.setAttribute('data-ad-slot', String(slotId));
          ins.setAttribute('data-ad-format', 'auto');
          ins.setAttribute('data-full-width-responsive', 'true');
          container.appendChild(ins);
          try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch (e) { /* ignore */ }
          return;
        }

        // Fallback placeholder (non-blocking UI when ads are blocked or not loaded)
        const placeholder = document.createElement('div');
        placeholder.className = 'ad-fallback';
        placeholder.innerHTML = '<div>Sponsored â€¢ Ad content unavailable. Please wait for the timer.</div>';
        container.appendChild(placeholder);
      } catch (err) {
        // don't break everything if something unexpected happens
        console.warn('ensureAdOrFallback error', err);
      }
    }

    // ---------- DOM ready init ----------
    function initUIHandlers(){
      if (cardsContainer) renderPage(1);

      const searchInput = document.getElementById('searchInput');
      const categoryFilter = document.getElementById('categoryFilter');
      if (searchInput) searchInput.addEventListener('input', function(){ searchTerm = this.value || ''; renderPage(1); });
      if (categoryFilter) categoryFilter.addEventListener('change', function(){ selectedCategory = this.value || 'all'; renderPage(1); });

      // mobile menu
      const mobileBtn = document.querySelector('.mobile-menu-btn');
      const navLinks = document.querySelector('.nav-links');
      if (mobileBtn) mobileBtn.addEventListener('click', () => { if (navLinks) navLinks.classList.toggle('active'); });

      // modal close handlers
      closeModal = document.querySelector('.close-modal');
      finalDownload = document.getElementById('finalDownload');
      downloadModal = document.getElementById('downloadModal');

      if (closeModal) closeModal.addEventListener('click', () => { stopAdProgress(); resetDownloadState(); if (downloadModal) downloadModal.classList.remove('show'); });
      if (finalDownload) finalDownload.addEventListener('click', (e) => {
        try {
          if (!finalDownload.getAttribute('href')) {
            Toastify({ text: 'Preparing download...', duration: 2000, gravity: 'top', position: 'center' }).showToast();
            return;
          }
          if (window.trackDownloadOnce && currentFile) window.trackDownloadOnce(currentFile);
          if (progressBar) progressBar.style.width = '100%';
          if (progressText) progressText.textContent = '100%';

          const body = document.querySelector('#downloadModal .modal-body');
          if (body) {
            let msg = body.querySelector('.download-inline-msg');
            if (!msg) {
              msg = document.createElement('div');
              msg.className = 'download-inline-msg';
              msg.textContent = 'Downloaded';
              body.appendChild(msg);
            } else {
              msg.textContent = 'Downloaded';
              msg.style.display = 'block';
            }
            setTimeout(() => { if (msg) msg.style.display = 'none'; if (downloadModal) downloadModal.classList.remove('show'); stopAdProgress(); resetDownloadState(); }, 3500);
          }
        } catch (err) { console.warn('download click handler', err); }
        // Do not prevent default; allow the browser to start download
        setTimeout(() => { /* keep state until close */ }, 0);
      });

      window.addEventListener('click', function (e) { if (downloadModal && e.target === downloadModal) { stopAdProgress(); resetDownloadState(); downloadModal.classList.remove('show'); } });

      // Popup ad logic (defensive) + exclusivity with special ads
      const popupAd = document.getElementById('popupAd');
      const popupClose = document.querySelector('.popup-close');
      const timerCount = document.getElementById('timerCount');

      function startPopupTimer() {
        if (!timerCount) return;
        let count = 10;
        timerCount.textContent = count;
        const timer = setInterval(() => {
          count--;
          timerCount.textContent = count;
          if (count <= 0) {
            clearInterval(timer);
            if (popupAd) popupAd.style.display = 'none';
          }
        }, 1000);
      }

      if (popupAd) {
        function anyAdPopupOpen(){ const ap = document.getElementById('adsPopup'); return isVisible(popupAd) || (ap && isVisible(ap)); }
        function showPopupAd(){
          if (anyAdPopupOpen()) return;
          popupAd.classList.add('show');
          requestAnimationFrame(() => { ensureAdOrFallback('.popup-ad-content', 9525901183); });
          startPopupTimer();
        }

        // ORIGINAL: show after 30s. For testing, change 30000 -> 3000
        setTimeout(showPopupAd, 30000);
        setInterval(() => { if (!isVisible(popupAd)) showPopupAd(); }, 60000);

        if (popupClose) popupClose.addEventListener('click', () => { if (popupAd) popupAd.classList.remove('show'); });
      }

      // Ads popup (center)
      const adsPopup = document.getElementById('adsPopup');
      const adsPopupClose = document.getElementById('adsPopupClose');

      function showAdsPopup() {
        if (!adsPopup) return;
        // Do not show if popupAd is visible
        if (popupAd && isVisible(popupAd)) return;
        adsPopup.classList.add('show');
        renderAdIn('.ads-popup-body', 4089957271);
      }
      function closeAdsPopup() { if (!adsPopup) return; adsPopup.classList.remove('show'); }

      if (adsPopupClose) adsPopupClose.addEventListener('click', closeAdsPopup);
      // ORIGINAL: show after 15s. For testing, change 15000 -> 3000
      setTimeout(() => { if (adsPopup) showAdsPopup(); }, 15000);
      setInterval(() => { if (adsPopup && (!adsPopup.style.display || adsPopup.style.display === 'none')) showAdsPopup(); }, 120000);
      window.addEventListener('click', function (e) { if (adsPopup && e.target === adsPopup) closeAdsPopup(); });

      // initial ad load + responsive reload
      window.addEventListener('load', function () { setTimeout(loadAllAds, 1000); });
      window.addEventListener('resize', function () { setTimeout(loadAllAds, 500); });

      // Close modals on Escape
      window.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' || e.key === 'Esc') {
          if (downloadModal) downloadModal.classList.remove('show');
          if (popupAd) popupAd.classList.remove('show');
          if (adsPopup) adsPopup.classList.remove('show');
        }
      });

      // expose debug helpers
      window.showAdsPopupNow = showAdsPopup;
      window.showPopupAdNow = function(){ const p = document.getElementById('popupAd'); if (p) p.classList.add('show'); requestAnimationFrame(()=> ensureAdOrFallback('.popup-ad-content',9525901183)); };
      window.testOpenDownloadModal = function(url){ const p = document.getElementById('downloadModal'); if (p) p.classList.add('show'); const fd = document.getElementById('finalDownload'); if (fd) { fd.href = url || '#'; fd.setAttribute('download',(url||'file').split('/').pop()); } };

      console.log('UI handlers attached. adsbygoogle defined:', !!window.adsbygoogle);
    }

    function init(){
      // call handler attach and initial render
      initUIHandlers();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

  })();
  </script>
  <script type="module" src="/js/download-tracker.js"></script>
  <script type="module" src="/js/components/component-loader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</body>
</html>
